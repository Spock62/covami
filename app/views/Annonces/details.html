#{extends 'main.html' /}
#{set title:'Covami - DÃ©tails annonce' /}
%{def demandeEnCours = 0}%
%{def dejaDemande = 0}%

<h1>D&eacute;tails de l'annonce</h1>

<div id="details">
	<span class="nom_label">Annonceur</span>
	<span class="nom">${annonce?.monUtilisateur?.prenom.capitalizeWords()}&nbsp;${annonce?.monUtilisateur?.nom.capitalizeWords()}</span>

	<span class="nom_label">Date de depart</span>
	<span class="nom">${annonce?.monTrajet?.dateDepart.format('dd MMMM yyyy hh:mm', 'fr')}</span>
	
	<span class="nom_label">Tarif total</span>
	<span class="nom">${annonce?.tarifParPersonne}&euro;</span>
	
	<span class="nom_label">Ville de depart</span>
	<span class="nom">${annonce?.monTrajet?.villeDepart?.nom}</span>
	
	<span class="nom_label">Ville d'arriv&eacute;e</span>
	<span class="nom">${annonce?.monTrajet?.villeArrivee?.nom}</span>
	
	#{if annonce.monTrajet.mesEtapes}
		<span class="nom_label">Escales</span>
		<span class="nom">-&nbsp;
			#{list items: annonce.monTrajet.mesEtapes, as:'etape' } 
				${etape.nom.capitalizeWords()}&nbsp;-&nbsp;
	 	 	#{/list}
 	 	</span>
	#{/if}
	#{if annonce.monUtilisateur.mesCriteres}
		<span class="nom_label">Crit&egrave;res accept&eacute;s</span>
		<span class="nom">-&nbsp;
			#{list items:annonce.monUtilisateur.mesCriteres, as:'critere' } 
				${critere.capitalizeWords()}&nbsp;-&nbsp;
	 	 	#{/list}
 	 	</span>
	#{/if}
	#{if annonce.mesPassagers}
		<span class="nom_label">Passagers</span>
		<span class="nom">-&nbsp;
			#{list items:annonce.mesPassagers, as:'passager' } 
				${passager.prenom.capitalizeWords()}&nbsp;${passager.nom.capitalizeWords()}&nbsp;-&nbsp;
	 	 	#{/list}
 	 	</span>
	#{/if}
	&nbsp;
</div>
<a class="submit" href="javascript:history.back()">Revenir &agrave; la liste</a>
#{if moi == annonce.monUtilisateur}
	<a class="submit" href="@{Annonces.editermonannonce(annonce.id)}">Editer</a>
#{/if}
#{list items : annonce.mesDemandePassagers, as: 'demande'}
	#{if demande.id == moi.id}
		%{demandeEnCours = 1}%
	#{/if}
#{/list}
#{list items : annonce.mesPassagers, as: 'passager'}
	#{if passager.id == moi.id}
		%{dejaDemande = 1}%
	#{/if}
#{/list}
#{if annonce.monUtilisateur != moi}
	#{if demandeEnCours == 0 || dejaDemande == 0}
		<a class="submit" href="@{Annonces.demandeparticipation(annonce.id)}">Demande de participation</a>
	#{/if}
#{/if}